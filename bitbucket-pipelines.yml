image: johngrimes/node-now
pipelines:
  default:
    - step:
        name: Run tests
        caches:
          - node
        script:
          - yarn write-config
          - yarn install
          - yarn test-ci
  branches:
    master:
      - step:
          name: Run tests and deploy
          caches:
            - node
          script:
            - yarn write-config
            - yarn install
            - yarn test-ci
            - yarn build
            - yarn build-docker
            - yarn push-docker
            - yarn make-release
            - yarn deploy
            - yarn record-release
options:
  docker: true
